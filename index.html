<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Legado ä¹¦æºä»“åº“</title>
    <style>
        :root { --primary-color: #2c3e50; }
        body { 
            font-family: "Segoe UI", sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header { 
            display: flex; 
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }
        .logo { 
            width: 60px; 
            height: 60px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header-text h1 {
            margin: 0;
            font-size: 1.8em;
            color: var(--primary-color);
        }
        .header-text p {
            margin: 0;
            color: #666;
            font-size: 0.95em;
        }

        /* é€šç”¨æ ·å¼ */
        .copy-btn { 
            cursor: pointer; 
            color: #2980b9; 
            margin-left: 10px; 
            font-size: 0.9em; 
            background: none;
            border: none;
            padding: 2px 5px;
        }
        .search-box { 
            width: 100%; 
            padding: 10px; 
            margin: 20px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px;
        }
        .source-item { 
            padding: 15px; 
            border-bottom: 1px solid #eee; 
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .source-item:hover { background: #f9f9f9; }
        .json-link { 
            color: var(--primary-color); 
            text-decoration: none;
            min-width: 150px;
        }
        .json-link:hover { text-decoration: underline; }
        .site-link {
            color: #666;
            text-decoration: none;
            font-size: 0.9em;
        }
        .site-link:hover { color: #2980b9; }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 480px) {
            header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .logo { width: 50px; height: 50px; }
            .header-text h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <header>
        <img src="/src/imgs/logo.jpg" class="logo" alt="ç½‘ç«™logo">
        <div class="header-text">
            <h1>Legado è‡ªç”¨ä¹¦æºä»“åº“</h1>
            <p>Legado 3.X é˜…è¯»å™¨ä¸“ç”¨ä¹¦æºé›†åˆï¼ŒæŒç»­æ›´æ–°ç»´æŠ¤</p>
        </div>
    </header>

    <section>
        <h2>ğŸ“š ä½¿ç”¨æ–¹æ³•</h2>
        <ul>
            <li>æ–¹æ³•ä¸€ï¼šå°†ä¹¦æºåˆé›†é“¾æ¥æ·»åŠ ä¸ºè§„åˆ™è®¢é˜…</li>
            <li>æ–¹æ³•äºŒï¼šå¤åˆ¶å•ä¸ªä¹¦æºé“¾æ¥åˆ°é˜…è¯»APPæ·»åŠ </li>
        </ul>
    </section>

    <section>
        <h2>ğŸ“¦ ä¹¦æºåˆé›†</h2>
        <div id="main-source">
            <a href="https://fammcao.github.io/legadoPublic/BookSources/BookSource.json" 
               class="json-link"
               target="_blank">
               https://fammcao.github.io/legadoPublic/BookSources/BookSource.json
            </a>
            <button onclick="copyUrl('https://fammcao.github.io/legadoPublic/BookSources/BookSource.json')" 
                    class="copy-btn">å¤åˆ¶é“¾æ¥</button>
        </div>
    </section>

    <section>
        <h2>ğŸ” å•ä¸ªä¹¦æºåˆ—è¡¨</h2>
        <input type="text" id="searchInput" class="search-box" placeholder="è¾“å…¥ä¹¦æºåç§°æˆ–ç½‘å€æœç´¢...">
        <div id="sourceList"></div>
    </section>

    <script>
        // æå–ä¸­æ–‡åå‡½æ•°
        function extractChineseName(text) {
            const match = text.match(/ã€(.*?)ã€‘/);
            return match ? match[1] : text;
        }

        // è‡ªåŠ¨åŠ è½½ä¹¦æºåˆ—è¡¨
        window.onload = async () => {
            try {
                const response = await fetch('https://api.github.com/repos/FamMcao/legadoPublic/contents/BookSources/each');
                const files = await response.json();
                
                let html = '';
                for (const file of files) {
                    if (file.name.endsWith('.json')) {
                        const jsonUrl = `https://fammcao.github.io/legadoPublic/BookSources/each/${file.name}`;
                        const res = await fetch(jsonUrl);
                        const data = await res.json();
                        
                        // å¤„ç†æ•°æ®
                        const chineseName = extractChineseName(data.bookSourceName);
                        const siteUrl = data.bookSourceUrl.startsWith('http') 
                            ? data.bookSourceUrl 
                            : `http://${data.bookSourceUrl}`;

                        html += `
                            <div class="source-item">
                                <a href="${jsonUrl}" class="json-link" target="_blank">${chineseName}</a>
                                <a href="${siteUrl}" class="site-link" target="_blank">${data.bookSourceUrl}</a>
                                <div style="margin-left: auto;">
                                    <button onclick="copyUrl('${jsonUrl}')" class="copy-btn">å¤åˆ¶ä¹¦æº</button>
                                    <button onclick="copyUrl('${siteUrl}')" class="copy-btn">å¤åˆ¶ç½‘å€</button>
                                </div>
                            </div>
                        `;
                    }
                }
                document.getElementById('sourceList').innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½ä¹¦æºå¤±è´¥:', error);
                document.getElementById('sourceList').innerHTML = '<div style="color:red">ä¹¦æºåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        };

        // æœç´¢åŠŸèƒ½ï¼ˆå¸¦é˜²æŠ–ï¼‰
        let searchTimer;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(() => {
                const query = e.target.value.toLowerCase();
                document.querySelectorAll('.source-item').forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(query) ? 'flex' : 'none';
                });
            }, 300);
        });

        // æ”¹è¿›ç‰ˆå¤åˆ¶å‡½æ•°
        function copyUrl(text) {
            navigator.clipboard.writeText(text)
                .then(() => alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))
                .catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('å·²æ‰‹åŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿');
                });
        }
    </script>
</body>
</html>
